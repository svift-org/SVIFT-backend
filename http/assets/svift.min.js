var SVIFT={};SVIFT.helper={},SVIFT.helper.debouncer=function(t,e){var a,n=e||200;return function(){var e=this,i=arguments;clearTimeout(a),a=setTimeout(function(){t.apply(e,Array.prototype.slice.call(i))},n)}},SVIFT.helper.interpolate=function(t){var e,a={};for(a.def=t,a.interpolate=[],a.duration=0,e=1;a.def.length>e;e++)"ease"in a.def[e]||(a.def[e].ease=!1),a.interpolate.push(d3.interpolate(a.def[e-1].value,a.def[e].value)),a.duration+=a.def[e].duration;var n=0;for(e=1;a.def.length>e;e++)a.def[e].duration=a.def[e].duration/a.duration,a.def[e].start=n,n+=a.def[e].duration;return a.i=function(t){for(var e=1;a.def.length>e;e++)if(t>=a.def[e].start&&a.def[e].start+a.def[e].duration>=t)return a.def[e].ease?a.interpolate[e-1](a.def[e].ease((t-a.def[e].start)/a.def[e].duration)):a.interpolate[e-1]((t-a.def[e].start)/a.def[e].duration)},a.i},SVIFT.helper.switchCol=function(t,e,a){return t.forEach(function(t){var n=t[e];t[e]=t[a],t[a]=n}),t},SVIFT.helper.transpose=function(t){var e={};return t.forEach(function(t){for(var a in t)a in e||(e[a]=[])}),t.forEach(function(t){for(var a in e)a in t?e[a].push(t[a]):e[a].push(null)}),e},SVIFT.helper.cleanAxis=function(t){var e;e=t.attr("text-anchor")?t:t.select('g[text-anchor="*"]');var a=e.attr("text-anchor");e.selectAll("text").attr("text-anchor",a);var n=e.attr("font-size");e.selectAll("text").each(function(){var t=d3.select(this);["y","x"].forEach(function(e){var a=t.attr("d"+e);if(a){a.indexOf("em")>=0&&(a=parseFloat(a.substr(0,a.length-2))*n),t.attr("d"+e,0);var i=t.attr(e);i&&(a+=parseFloat(i)),t.attr(e,a)}})})},SVIFT.vis={},SVIFT.vis.base=function(t,e){var a={};return a.data=t,a.setData=function(t){a.data=t},a.container=e,a.g=null,a.svg=null,a.scale=!1,a.vizContainer=null,a.vizSize={width:500,height:500},a.vizInitSize={width:500,height:500},a.containerSize={width:0,height:0},a.theme=t.style.theme,a.color=t.style.color.main,a.config={maxWidth:4096,maxHeight:4096,margin:{top:20,right:20,bottom:20,left:20},font:{sizes:{450:15,0:13},"default":"13px"},footerHeight:40},a.text={},a.timeline={},a.init=function(){a.scale=!1,a.vizInitSize.width=a.containerSize.width=a.container.node().offsetWidth,a.vizInitSize.height=a.containerSize.height=a.container.node().offsetHeight,a.vizSize.width=a.vizInitSize.width-a.config.margin.right-a.config.margin.left,a.vizSize.height=a.vizInitSize.height,a.svg=a.container.append("svg").attr("viewBox","0 0 "+a.containerSize.width+" "+a.containerSize.height).attr("class",a.theme+" "+a.color),a.defs=a.svg.append("defs"),a.g=a.svg.append("g").attr("transform","translate("+a.config.margin.top+","+a.config.margin.left+")"),a.text.head=a.g.append("g").attr("class","title-wrapper"),a.text.title=a.text.head.append("text").attr("class","titleFont"),a.text.subtitle=a.text.head.append("text").attr("class","subtitleFont"),a.text.foot=a.g.append("g").attr("transform","translate(0,"+(a.containerSize.height-a.config.margin.bottom-a.config.margin.top)+")").attr("class","bottomTextWrapper"),a.text.attribution=a.text.foot.append("text").attr("x",a.containerSize.width-a.config.margin.left-a.config.margin.right).text(t.data.attribution).attr("class","attribution"),a.text.source=a.text.foot.append("text").text(t.data.source).attr("class","source"),a.vizContainer=a.g.append("g").attr("class","viz-container"),a.playHead=0,a.setup(),a.updateHead();for(var e in a.timeline){var n=a.timeline[e];n.end>a.playTime&&(a.playTime=n.end)}a.time.step=a.playTime/(a.playTime/1e3*a.time.fps),"function"==typeof window.callPhantom&&window.callPhantom({msg:"setupDone"}),d3.select(window).on("resize",SVIFT.helper.debouncer(function(){a.preResize(),a.scale||a.resize()},200))},a.updateHead=function(){var e=30,n=0,i=1.1,r=e;if(a.vizSize.width=a.vizInitSize.width-a.config.margin.left-a.config.margin.right,t.data.title.length>0){var o=t.data.title.split("\n");a.text.title.selectAll("tspan").remove(),o.forEach(function(t){for(var n=e,i=a.text.title.append("tspan").text(t).attr("x",0).style("font-size",n);i.node().getComputedTextLength()>a.vizSize.width||5>n;)n--,i.style("font-size",n);r>n&&(r=n)}),a.text.title.attr("transform","translate(0,"+r+")"),a.text.title.selectAll("tspan").attr("dy",function(t,e){return e>0?r*i:0}).style("font-size",r),n=r*i*(o.length-1)+r}var d=15,c=1.1,s=0,l=d>r?.75*r:d;t.data.subTitle.length>0&&(o=t.data.subTitle.split("\n"),a.text.subtitle.selectAll("tspan").remove(),o.forEach(function(t){for(var e=d,n=a.text.subtitle.append("tspan").text(t).attr("x",0).style("font-size",e);n.node().getComputedTextLength()>a.vizSize.width||5>e;)e--,n.style("font-size",e);l>e&&(l=e)}),a.text.subtitle.selectAll("tspan").attr("dy",function(t,e){return e>0?l*c:0}).style("font-size",l),a.text.subtitle.attr("transform","translate(0,"+Math.round(n+1.55*l)+")"),s+=2*l+l*c*(o.length-1)),a.vizContainer.attr("transform","translate(0,"+(s+n)+")"),a.vizSize.height=a.vizInitSize.height-(s+n)-a.config.margin.top-a.config.margin.bottom-a.config.footerHeight-15,a.text.foot.attr("transform","translate(0,"+(a.vizInitSize.height-a.config.margin.bottom-a.config.margin.top)+")"),a.text.attribution.attr("x",a.vizInitSize.width-a.config.margin.left-a.config.margin.right),a.resize()},a.setTheme=function(t){a.svg.classed(a.theme,!1),a.theme=t,a.svg.classed(a.theme,!0),a.updateHead()},a.setColor=function(t){a.svg.classed(a.color,!1),a.color=t,a.svg.classed(a.color,!0),a.updateHead()},a.updateSource=function(){a.text.source.text(t.data.source)},a.reset=function(){a.vizContainer.selectAll("*").remove(),a.setup(),a.preResize()},a.process=function(){},a.setup=function(){},a.update=function(){},a.preResize=function(){a.containerSize.width=a.container.node().offsetWidth,a.containerSize.height=a.container.node().offsetHeight,a.scale||(a.svg.attr("viewBox","0 0 "+a.containerSize.width+" "+a.containerSize.height),a.vizInitSize.width=a.containerSize.width,a.vizInitSize.height=a.containerSize.height),a.updateHead()},a.setScale=function(t){a.scale=t},a.resize=function(){},a.draw=function(t){for(var e in a.timeline){var n=a.timeline[e];t>=n.start&&n.end>=t?n.func((t-n.start)/(n.end-n.start)):t>n.end&&n.func(1)}},a.playHead=0,a.playState=!1,a.playTime=0,a.time={fps:30,step:0,elapsed:0,fpsInterval:1e3/30,then:0,startTime:0,now:0},a.play=function(){a.playState&&("function"==typeof window.callPhantom?(a.playHead+=a.time.step,a.playTime>=a.playHead?(a.draw(a.playHead),window.callPhantom({msg:"drawDone",playHead:a.playHead})):(a.playHead=a.playTime,a.draw(a.playHead),a.pause(),window.callPhantom({msg:"playDone"}))):(0===a.time.then&&(a.time.then=a.time.startTime=Date.now()),a.time.now=Date.now(),a.time.elapsed=a.time.now-a.time.then,a.playTime>=a.time.now-a.time.startTime?(window.requestAnimationFrame(a.play),a.time.elapsed>a.time.fpsInterval&&(a.time.then=a.time.now-a.time.elapsed%a.time.fpsInterval,a.playHead=a.time.now-a.time.startTime,a.draw(a.playHead))):(a.playHead=a.playTime,a.goTo(1),a.pause())))},a.start=function(){a.playState=!0,a.play()},a.pause=function(){a.playState=!1},a.goTo=function(t){a.playTime>=t&&(a.playHead=t*a.playTime,a.draw(a.playHead)),a.pause()},a},SVIFT.vis.columns=function(t,e){var a=SVIFT.vis.base(t,e);a.d3config={ease:d3.easeQuadOut,yInterpolate:[],hInterpolate:[],oInterpolate:[],steps:t.data.data.length,animation:{duration:3e3,barPartPercent:.8}},a.setup=function(){a.d3config.barsContainer=a.vizContainer.append("g").selectAll("g").data(t.data.data).enter().append("g"),a.d3config.bars=a.d3config.barsContainer.append("rect").style("stroke","transparent").attr("class","visFill").style("opacity",1),a.d3config.barsText=a.d3config.barsContainer.append("text").text(function(t){return t.label}).attr("class","labelText").attr("text-anchor","middle").style("opacity",0),a.d3config.barsNumber=a.d3config.barsContainer.append("text").text(function(t){return t.data[0]}).attr("class","labelNumber").attr("text-anchor","middle").style("opacity",0);for(var e=a.d3config.animation.duration*a.d3config.animation.barPartPercent,n=e/a.d3config.steps,i=0;a.d3config.steps>i;i++){var r=n*i-n/2;0==i&&(r=0);var o=n*(i+1);a.timeline["animationBar"+i]={start:r,end:o,func:a["drawBar"+i]}}for(var d=a.d3config.animation.duration-e,c=d/a.d3config.steps,i=0;a.d3config.steps>i;i++){var r=c*i-c/2+e;0==i&&(r=e);var o=c*(i+1)+e;a.timeline["animationBarText"+i]={start:r,end:o,func:a["drawBarLable"+i]}}},a.update=function(){a.d3config.barsContainer.data(t.data.data).enter(),a.d3config.bars.datum(function(t){return t}),a.d3config.barsText.datum(function(t){return t}).text(function(t){return t.label}),a.d3config.barsNumber.datum(function(t){return t}).text(function(t){return t.data[0]})},a.resize=function(){a.d3config.x=d3.scaleBand().padding(.1).domain(t.data.data.map(function(t,e){return e})),a.d3config.y=d3.scaleLinear().domain([0,d3.max(t.data.data,function(t){return t.data[0]})]);var e=a.d3config.barsNumber._groups[0][0].getBBox().height;a.d3config.barsText._groups[0][0].getBBox().height;var n=6,i=e+n;a.d3config.barsContainer.attr("transform","translate(0,"+i+")");var r=a.vizSize.width,o=a.vizSize.height-i;a.d3config.x.range([0,r]),a.d3config.y.range([o,0]),a.d3config.bars.attr("x",function(t,e){return a.d3config.x(e)}).attr("width",a.d3config.x.bandwidth()).attr("opacity",0),a.d3config.barsText.attr("x",function(t,e){return a.d3config.x(e)+a.d3config.x.bandwidth()/2}).attr("y",function(){return this.getBBox().height+o+n}).attr("font-size","1em").attr("opacity",0),a.d3config.barsNumber.attr("x",function(t,e){return a.d3config.x(e)+a.d3config.x.bandwidth()/2}).attr("y",function(t){return a.d3config.y(t.data[0])-n}).attr("font-size","1em").attr("opacity",0),t.data.data.forEach(function(t,e){a.d3config.yInterpolate[e]=d3.interpolate(o,a.d3config.y(t.data[0])),a.d3config.hInterpolate[e]=d3.interpolate(0,o-a.d3config.y(t.data[0])),a.d3config.oInterpolate[e]=d3.interpolate(0,1)}),a.playHead==a.playTime&&(a.goTo(1),a.pause())};for(var n=function(t){return function(e){d3.select(a.d3config.bars._groups[0][t]).attr("y",function(){return a.d3config.yInterpolate[t](a.d3config.ease(e))}).attr("height",function(){return a.d3config.hInterpolate[t](a.d3config.ease(e))}).attr("opacity",function(){return a.d3config.oInterpolate[t](a.d3config.ease(e))})}},i=0;a.d3config.steps>i;i++)a["drawBar"+i]=n(i);for(var r=function(t){return function(e){d3.select(a.d3config.barsText._groups[0][t]).style("opacity",function(){return a.d3config.oInterpolate[t](a.d3config.ease(e))}),d3.select(a.d3config.barsNumber._groups[0][t]).style("opacity",function(){return a.d3config.oInterpolate[t](a.d3config.ease(e))})}},i=0;a.d3config.steps>i;i++)a["drawBarLable"+i]=r(i);return a},SVIFT.vis.count=function(t,e){var a=SVIFT.vis.base(t,e);return a.d3config={ease:d3.easeCubicInOut,interpolate:d3.interpolate(0,t.data.data[0].data[0])},a.setup=function(){a.d3config.count=a.vizContainer.append("text").text(t.data.data[0].data[0]).attr("fill",t.style.color.main).attr("text-anchor","middle").attr("font-size",1).attr("class","labelTextFont visFill").attr("opacity",0).attr("font-family",t.style.font)},a.resize=function(){var t=Math.min(a.vizSize.height,a.vizSize.width);console.log(a.config),a.d3config.count.attr("x",a.vizSize.width/2).attr("font-size",function(){var e=this.getBBox(),n=Math.max(e.width,e.height),i=d3.select(this).attr("font-size");return a.d3config.fatNumberNewSize=.8*i*(t/n),a.d3config.fatNumberNewSize}).attr("y",function(){return a.vizSize.height/2+.34*this.getBBox().height})},a.animateNumber=function(t){var e=Math.round(a.d3config.interpolate(a.d3config.ease(t)));a.d3config.count.text(e).attr("opacity",1)},a.timeline={bars:{start:0,end:3e3,func:a.animateNumber}},a},SVIFT.vis.gooey=function(t,e){var a=SVIFT.vis.base(t,e),n=t.data.data.length;a.d3config={steps:n,allCirlcesInterpolation:d3.interpolate(0,n),ease:d3.easeCubicInOut,easeBigCircle:d3.easeExpInOut,sizes:function(){for(var e=[],a=0;n>a;a++)e.push(Math.sqrt(t.data.data[a].data[0]/Math.PI));return e}(),circleColorInterpolations:function(){for(var e=[],a=0;n>a;a++)e[a]=d3.scaleLinear().domain([0,1]).range([d3.rgb(t.style.color.dataColors[a]),d3.rgb(t.style.color.dataColors[a+1])]),a==n-1&&(e[a]=d3.scaleLinear().domain([0,1]).range([d3.rgb(t.style.color.dataColors[a]),d3.rgb(t.style.color.dataColors[a])]));return e}(),animation:{duration:6e3,gooeyPercent:.85}},a.setup=function(){a.d3config.gooeyContainer=a.vizContainer.append("g").style("filter","url(#gooey)"),a.d3config.filter=a.d3config.gooeyContainer.append("filter").attr("id","gooey"),a.d3config.filter.append("feGaussianBlur").attr("in","SourceGraphic").attr("stdDeviation","10").attr("result","blur"),a.d3config.filter.append("feColorMatrix").attr("in","blur").attr("mode","matrix").attr("values","1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 18 -7"),a.d3config.circles=a.d3config.gooeyContainer.selectAll("circle").data(t.data.data).enter().append("circle").attr("cx",0).attr("cy",0).style("fill",function(e,a){return t.style.color.dataColors[a]});for(var e=a.d3config.animation.duration*a.d3config.animation.gooeyPercent,n=e/a.d3config.steps,i=0;a.d3config.steps>i;i++)a.timeline["animation"+i]={start:n*i,end:n*(i+1),func:a["animate"+i]};for(var r=a.d3config.animation.duration-e,o=r/a.d3config.steps,i=0;a.d3config.steps>i;i++){var d=o*i+e;0==i&&(d=e);var c=o*(i+1)+e;a.timeline["animationBarText"+i]={start:d,end:c,func:a["drawBarLable"+i]}}a.d3config.centerCircle=a.d3config.gooeyContainer.append("circle").attr("class","centerCircle").attr("cx",0).attr("cy",0),a.d3config.bubbleLables=a.vizContainer.append("g").selectAll("text").data(t.data.data).enter().append("text").text(function(t){return t.label+" - "+t.data[0]}).attr("fill",t.style.color.second).attr("text-anchor","middle").attr("class","labelText")},a.resize=function(){var e=a.vizSize.width,n=a.vizSize.height,i=Math.min(e,n);a.d3config.xScale=d3.scaleLinear().domain([-1.5,1.5]).range([-i/1.7,i/1.7]);var r=n/2;a.d3config.gooeyContainer.attr("transform","translate("+e/2+","+r+")");var o=d3.range(a.d3config.steps).map(function(t){return t/a.d3config.steps*2*Math.PI});a.d3config.cyInterpolation=[],a.d3config.cxInterpolation=[];for(var d=0;o.length>d;d++){var c=a.d3config.xScale(Math.sin(o[d]));a.d3config.cyInterpolation.push(d3.interpolate(0,c));var s=a.d3config.xScale(Math.cos(o[d]));a.d3config.cxInterpolation.push(d3.interpolate(0,s))}for(var l=i/10,f=d3.interpolate(0,l),g=Math.max.apply(Math,a.d3config.sizes),u=[],d=0;a.d3config.steps>d;d++)u.push(f(a.d3config.sizes[d]/g));a.d3config.circles.attr("r",function(t,e){return u[e]});for(var p=0,d=0;a.d3config.steps>d;d++){var h=Math.PI*Math.pow(u[d],2);p+=h}var m=[];m.push(p);for(var d=0;a.d3config.steps>d;d++){var h=Math.PI*Math.pow(u[d],2);p-=h,m[d+1]=p}m[m.length-1]=0,largerCircleInterpolations=[];for(var d=0;a.d3config.steps>d;d++)largerCircleInterpolations.push(d3.interpolate(Math.sqrt(m[d]/Math.PI),Math.sqrt(m[d+1]/Math.PI)));a.d3config.centerCircle=a.d3config.gooeyContainer.append("circle").attr("r",largerCircleInterpolations[0](0)).style("fill",t.style.color.dataColors[0]),a.d3config.bubbleLables.attr("dx",function(t,n){return a.d3config.cxInterpolation[n](1)+e/2}).attr("dy",function(t,e){return a.d3config.cyInterpolation[e](1)+r+u[e]+1.2*this.getBBox().height}).attr("font-size","1em").attr("opacity",0)};for(var i=function(t){return function(e){d3.select(a.d3config.circles._groups[0][t]).attr("cy",a.d3config.cyInterpolation[t](a.d3config.ease(e))).attr("cx",a.d3config.cxInterpolation[t](a.d3config.ease(e))),a.d3config.centerCircle.attr("r",largerCircleInterpolations[t](a.d3config.easeBigCircle(e))).style("fill",a.d3config.circleColorInterpolations[t](a.d3config.ease(e)))}},r=function(t){return function(){d3.select(a.d3config.bubbleLables._groups[0][t]).attr("opacity",1)}},o=0;a.d3config.steps>o;o++)a["animate"+o]=i(o),a["drawBarLable"+o]=r(o);return a},SVIFT.vis.line=function(t,e){var a=SVIFT.vis.base(t,e);return a.d3config={},a.setup=function(){},a.process=function(){},a.update=function(){},a.resize=function(){for(var e=a.container.node().offsetWidth-2*(a.config.margin.left+a.config.margin.right),n=a.container.node().offsetHeight-a.config.margin.top-a.config.margin.bottom-a.config.topTextHeight-a.config.bottomTextHeight,i=[1,t.data.data.length],r=[],o=0;t.data.data.length>o;o++)r=r.concat(t.data.data[o].data);var d=d3.extent(r,function(t){return t}),c=d3.scaleLinear().domain(i).range([0,e]),s=d3.scaleLinear().domain(d).range([n,0]),l=a.g.append("g").datum(t.data.data).attr("width",e).attr("height",n).append("g").attr("transform","translate(0,"+(a.config.margin.top+a.config.topTextHeight)+")");l.append("g").attr("class","axis axis--x").attr("transform","translate(0,"+n+")").call(d3.axisBottom(c).tickFormat(function(e,a){return t.data.data[a].label}).ticks(t.data.data.length-1)),l.append("g").attr("class","axis axis--y").call(d3.axisLeft(s)).append("text").attr("fill","#000").attr("transform","rotate(-90)").attr("y",6).attr("dy","0.71em").attr("text-anchor","end").text("Price ($)");for(var o=0;t.data.data[0].data.length>o;o++){var f=d3.line().defined(function(t){return t.data[o]}).x(function(t,e){return c(e+1)}).y(function(t){return s(t.data[o])}),g=l.append("path").attr("fill","none").attr("stroke",t.data.colors[o]).attr("stroke-linejoin","round").attr("stroke-linecap","round").attr("stroke-width",3.5).attr("d",f),u=g.node().getTotalLength();g.attr("stroke-dasharray",u+" "+u).attr("stroke-dashoffset",u).transition().duration(2e3).ease(d3.easeCubicInOut).attr("stroke-dashoffset",0)}},a.timeline={},a},SVIFT.vis.mosaic=function(t,e){var a=SVIFT.vis.base(t,e);return a.d3config={ease:d3.easeCubicInOut,interpolate:d3.interpolate(0,t.data.data[0].data[0])},a.gridSetupData=function(t){var e=.1*t;t-=e;for(var a=Array(),n=1,i=1,r=0;10>r;r++){a.push(Array());for(var o=0;10>o;o++)a[r].push({x:n,y:i,width:t,height:t}),n+=t+e;n=1,i+=t+e}return a},a.setup=function(){var e=a.gridSetupData(10);a.d3config.rowContainer=a.vizContainer.append("g"),a.d3config.row=a.d3config.rowContainer.selectAll(".row").data(e).enter().append("g").attr("class","row"),a.d3config.column=a.d3config.row.selectAll(".square").data(function(t){return t}).enter().append("rect").attr("class","square").style("fill",t.data.colors[0]).style("stroke","#fff"),a.d3config.mosaicValueText=a.d3config.row.append("text").text(t.data.data[0].data[0]+"%").attr("font-family",t.style.font).attr("class","visFill labelText big").attr("text-anchor","middle")},a.resize=function(){var t=10,e=a.vizSize.width-t,n=a.vizSize.height-t,i=Math.min(e,n);a.d3config.mosaicValueText.attr("font-size","2.5em").attr("dominant-baseline","hanging");var r=a.d3config.mosaicValueText.node().getBBox().height,o=i-r;a.d3config.mosaicValueText.attr("x",o/2);var d=o/10,c=a.gridSetupData(d);a.d3config.rowContainer.attr("transform","translate("+(e-o)/2+","+15+")"),a.d3config.row.data(c).enter(),a.d3config.column.data(function(t){return t}).enter(),a.d3config.column.attr("x",function(t){return t.x}).attr("y",function(t){return t.y}).attr("width",function(t){return t.width}).attr("height",function(t){return t.height});var s=a.d3config.rowContainer.node().getBBox().height;a.d3config.mosaicValueText.attr("y",s+r/2)},a.drawBars=function(t){var e=Math.round(a.d3config.interpolate(a.d3config.ease(t)));d3.selectAll("rect").filter(function(t,a){return e-1>=a}).attr("class","visFill"),a.d3config.mosaicValueText.text(e+"%")},a.timeline={bars:{start:0,end:3e3,func:a.drawBars}},a};